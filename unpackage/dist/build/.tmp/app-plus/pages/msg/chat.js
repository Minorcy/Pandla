(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/msg/chat"],{"4f12":function(t,e,n){"use strict";n.r(e);var s=n("c26c"),i=n.n(s);for(var o in s)"default"!==o&&function(t){n.d(e,t,function(){return s[t]})}(o);e["default"]=i.a},"53fa":function(t,e,n){"use strict";n.r(e);var s=n("7cd7"),i=n("4f12");for(var o in i)"default"!==o&&function(t){n.d(e,t,function(){return i[t]})}(o);n("8a79");var a=n("2877"),r=Object(a["a"])(i["default"],s["a"],s["b"],!1,null,null,null);e["default"]=r.exports},"7c42":function(t,e,n){"use strict";(function(t){n("cbab"),n("921b");s(n("66fd"));var e=s(n("53fa"));function s(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},"7cd7":function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=(t._self._c,t.__map(t.msglist,function(e,n){var s=t._f("dateFormat")(e.time),i=t._f("generateRichTextNode")(e.message),o=t._f("generateRichTextNode")(e.message);return{$orig:t.__get_orig(e),f0:s,f1:i,f2:o}}));t.$mp.data=Object.assign({},{$root:{l0:n}})},i=[];n.d(e,"a",function(){return s}),n.d(e,"b",function(){return i})},"8a79":function(t,e,n){"use strict";var s=n("c358"),i=n.n(s);i.a},c26c:function(t,e,n){"use strict";(function(t,s){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(n("609e")),o=r(n("e9e9")),a=(r(n("4404")),n("9fe6"));function r(t){return t&&t.__esModule?t:{default:t}}var u=function(){return n.e("pages/msg/yszyun-imchat-emoji/chatinput").then(n.bind(null,"63df"))},f=i.default.emojiList.emoji,c={data:function(){return{sessionId:"",currSessionMsgs:"",title:"",userInfos:"",myInfo:"",msglist:"",paddingBottom:50}},components:{chatInput:u},onLoad:function(e){var n=this;this.sessionId=e.id,this.userInfo(),this.myInfo=t.getStorageSync("USERS_KEY"),t.$on("onMsg"+e.id,function(t){n.getMsg(t)})},methods:{interval:function(t,e){var n=Date.parse(new Date(t)),i=Date.parse(new Date(e)),o=i-n,a=Math.floor(o/6e4);return console.log(s(a," at pages\\msg\\chat.vue:89")),a>5||!(a<5)&&void 0},userInfo:function(){var e=this;t.showLoading({title:"加載中"}),setTimeout(function(){t.hideLoading()},2e3),(0,a.chatUserInfo)(this.sessionId).then(function(n){if(!n)return t.hideLoading(),void t.showToast({icon:"none",title:"该用户未注册，暂不能聊天"});e.userInfos=n,e.msgList(),t.setNavigationBarTitle({title:e.userInfos.name})})},msgList:function(){var e=this;if(this.msglist=t.getStorageSync("msg"+this.userInfos.id),!this.msglist)return t.hideLoading(),void(this.msglist=[]);setTimeout(function(){t.pageScrollTo({scrollTop:999999999,duration:0}),e.setSessinolist()},300),t.hideLoading()},getInputMessage:function(e){this.paddingBottom=50;var n=this;(0,a.sendMessage)(n.userInfos.id,e,1).then(function(s){s&&(n.msglist.push({from:{id:n.myInfo.id,avatar:n.myInfo.portrait,name:n.myInfo.name},message:e,to:{id:n.userInfos.id,avatar:n.userInfos.avatar,name:n.userInfos.name},time:(new Date).getTime(),type:1,lastMsgShow:0}),t.setStorageSync("msg"+n.userInfos.id,n.msglist),setTimeout(function(){t.pageScrollTo({scrollTop:9999999999,duration:0}),n.setSessinolist()},200))})},sendImg:function(){var e=this,n=this;(0,a.getImgTemp)().then(function(s){t.showLoading({title:"加载中"}),setTimeout(function(){t.hideLoading()},2e3),(0,a.uploadPictures)(s).then(function(s){(0,a.sendMessage)(n.userInfos.id,s,3).then(function(s){s&&(n.msglist.push({from:{id:n.myInfo.id,avatar:n.myInfo.portrait,name:n.myInfo.name},message:s,to:{id:n.userInfos.id,avatar:n.userInfos.avatar,name:n.userInfos.name},time:(new Date).getTime(),type:3,lastMsgShow:0}),t.setStorageSync("msg"+n.userInfos.id,n.msglist),t.hideLoading(),setTimeout(function(){t.pageScrollTo({scrollTop:9999999999,duration:0}),e.setSessinolist()},200))})})})},getMsg:function(e){this.msglist.push(e),setTimeout(function(){t.pageScrollTo({scrollTop:9999999999,duration:0})},200)},scrollEnd:function(){t.pageScrollTo({scrollTop:9999999999,duration:0})},show:function(){this.paddingBottom=300,setTimeout(function(){t.pageScrollTo({scrollTop:9999999999,duration:0})},300)},foc:function(){setTimeout(function(){t.pageScrollTo({scrollTop:9999999999,duration:300})},800)},setScrollH:function(){},toUser:function(){t.navigateTo({url:"/pages/daily/userInfo?uid="+this.sessionId})},previewImage:function(e){var n=[];this.msglist.filter(function(t){3==t.type&&n.push(t.message)});var i=n.indexOf(e);t.previewImage({urls:n,current:i,longPressActions:{itemList:["保存图片"],success:function(t){console.log(s("选中了第"+(t.tapIndex+1)+"个按钮,第"+(t.index+1)+"张图片"," at pages\\msg\\chat.vue:297"))},fail:function(t){console.log(s(t.errMsg," at pages\\msg\\chat.vue:300"))}}})},moveHandle:function(){},setSessinolist:function(){var e=this,n=t.getStorageSync("updateSessionList"),s=e.msglist.slice(-1);if(0!=s.length){var i=JSON.parse(JSON.stringify(s));i=i[0],i.lastMsgShow=0,i.to.id==e.sessionId&&(i.from={id:e.userInfos.id,avatar:e.userInfos.avatar,name:e.userInfos.name},i.lastMsgShow=0);var o=!1,a=0;if(0==n.length){n=[];return n.unshift(i),t.setStorageSync("updateSessionList",n),void t.$emit("updateSessionList",n)}if(n.filter(function(t,n){t.from.id==e.sessionId&&(o=!0,a=n)}),o){n.splice(a,1,i);var r=n[0];return n[0]=i,n[a]=r,t.setStorageSync("updateSessionList",n),void t.$emit("updateSessionList",n)}n.unshift(i),t.setStorageSync("updateSessionList",n),t.$emit("updateSessionList",n)}}},onNavigationBarButtonTap:function(){t.navigateTo({url:"chatSettings?userInfo="+JSON.stringify(this.userInfos)})},onBackPress:function(){t.hideKeyboard(),this.setSessinolist()},onShow:function(){var e=this;(0,a.chatUserInfo)(this.sessionId).then(function(n){e.userInfos=n,t.setNavigationBarTitle({title:e.userInfos.name})})},filters:{dateFormat:function(t){return t=Number(t),o.default.formatDate(t,!0)},generateRichTextNode:function(t){var e=t,n=[],s=e.indexOf("["),i=e.indexOf("]"),o=0;if(Array.from(e).map(function(t){"["!=t&&"]"!=t&&o++}),-1==s||-1==i||0==o)return n.push({type:"text",text:e}),n;while(0!=e.length)if(s=e.indexOf("["),i=e.indexOf("]"),0==s)if(i=e.indexOf("]"),-1==i)n.push({type:"text",text:e}),e="";else{var a=e.slice(0,i+1);f[a]?n.push({name:"img",attrs:{width:"30rpx",height:"30rpx",src:f[a].img}}):n.push({type:"text",text:a}),e=e.substring(i+1,e.length)}else-1==s?(n.push({type:"text",text:e.slice(0,e.length)}),e=""):(n.push({type:"text",text:e.slice(0,s)}),e=e.substring(s,e.length+1));return n}}};e.default=c}).call(this,n("6e42")["default"],n("0de9")["default"])},c358:function(t,e,n){}},[["7c42","common/runtime","common/vendor"]]]);