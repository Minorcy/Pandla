(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/daily/daily"],{"2bd5":function(t,n,e){"use strict";var o=function(){var t=this,n=t.$createElement,e=(t._self._c,t.__map(t.dynInfo,function(n,e){var o=Math.abs(t.index-e);return{$orig:t.__get_orig(n),g0:o}}));t.$mp.data=Object.assign({},{$root:{l0:e}})},i=[];e.d(n,"a",function(){return o}),e.d(n,"b",function(){return i})},"30a8":function(t,n,e){"use strict";var o=e("3ca5"),i=e.n(o);i.a},"3ca5":function(t,n,e){},dbcd:function(t,n,e){"use strict";e.r(n);var o=e("dc48"),i=e.n(o);for(var c in o)"default"!==c&&function(t){e.d(n,t,function(){return o[t]})}(c);n["default"]=i.a},dc48:function(t,n,e){"use strict";(function(t,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=s(e("a34a")),c=s(e("c56b")),a=e("9fe6");function s(t){return t&&t.__esModule?t:{default:t}}function r(t,n,e,o,i,c,a){try{var s=t[c](a),r=s.value}catch(u){return void e(u)}s.done?n(r):Promise.resolve(r).then(o,i)}function u(t){return function(){var n=this,e=arguments;return new Promise(function(o,i){var c=t.apply(n,e);function a(t){r(c,o,i,a,s,"next",t)}function s(t){r(c,o,i,a,s,"throw",t)}a(void 0)})}}function l(t){return m(t)||f(t)||d()}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function f(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function m(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}var h=t.getSystemInfoSync(),p=function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"65e7"))},g=function(){return Promise.all([e.e("common/vendor"),e.e("components/comments")]).then(e.bind(null,"ad0d"))},y=function(){return e.e("components/l-barrage/l-barrage").then(e.bind(null,"6059"))},v={components:{uniPopup:p,comm:g,lBarrage:y},data:function(){return{sysheight:0,dynInfo:"",uid:"",did:"",cid:"",parentId:"",toid:"",likeNumber:0,height:"667px",index:0,width:"",oldIndex:0,commentInfo:[],moreComment:[],commCount:0,addType:"comm",pageCount:10,flag:!0,flog:!0,isActive:!1,showBullet:!0,showComment:!1}},created:function(){plus.screen.lockOrientation("portrait-primary"),this.sysheight=t.getSystemInfoSync().windowHeight,this.height="".concat(this.sysheight,"px");var n=t.getSystemInfoSync().windowWidth;this.width="".concat(n,"px")},onTabItemTap:function(){var t=this;this.refresh+=1,setTimeout(function(){t.refresh=0},800),2==this.refresh&&(this.findDyn(),this.refresh=0)},onLoad:function(){this.findDyn()},methods:{findDyn:function(){var t=this;(0,a.findAllDyn)(0).then(function(n){t.dynInfo=n,t.uid=n[0].uid,t.index=0,t.did=n[0].id,t.getAllBullet(),t.flag=!0})},toMap:function(n,e,i){""==n&&""==e&&""==i||t.openLocation({latitude:Number(n),longitude:Number(e),name:i,success:function(t){console.log(o(t," at pages\\daily\\daily.vue:166"))}})},userFollow:function(t,n){var e=this;(0,a.concern)(1,t).then(function(t){e.dynInfo[n].following=1})},userInfo:function(n){t.navigateTo({url:"/pages/daily/userInfo?uid="+n})},changeCurrent:function(t){var n=this;this.did=this.dynInfo[t.detail.current].id,this.likeNumber=0,this.getAllBullet(),this.uid=this.dynInfo[t.detail.current].uid,(0,a.checkIsCon)(this.dynInfo[t.detail.current].uid).then(function(e){e?n.dynInfo[t.detail.current].following=1:0==e&&(n.dynInfo[t.detail.current].following=0)})},animationfinish:function(t){this.index=t.detail.current},transitioning:function(n){var e=this;0==this.index&&n.detail.dy<-100&&this.flog&&(t.showLoading({title:"加载中"}),this.flog=!1,this.findDyn(),setTimeout(function(){t.hideLoading(),e.flog=!0},1e3)),this.index+1==this.pageCount&&n.detail.dy>100&&this.flag&&this.flag&&(this.flag=!1,t.showLoading({title:"加载中"}),this.loadFindDyn(),setTimeout(function(){t.hideLoading(),e.flag=!0},1e3))},loadFindDyn:function(){var n=this;(0,a.findAllDyn)(this.pageCount).then(function(e){n.pageCount+=e.length,n.dynInfo=[].concat(l(n.dynInfo),l(e)),0==e.length&&t.showToast({icon:"none",title:"没有更多数据了"})})},likePerson:function(n,e,o){var i=this;1==n?t.showToast({icon:"none",title:"不可以給自己點贊哦"}):(this.likeNumber++,(0,a.like)(e,1).then(function(n){i.isActive=!0,(0,a.likeCount)(e).then(function(n){i.dynInfo[o].isLike=1,i.dynInfo[o].like_count=n,i.dynInfo[o].pan=n/10,t.showToast({icon:"none",title:"點贊了"+i.likeNumber+"次"});var e=setTimeout(function(){clearTimeout(e),i.isActive=!1},1500)})}),this.isActive=!1)},tapAvater:function(){t.showToast({icon:"none",title:"点击索引为".concat(this.index,"的头像")})},tapMsg:function(t,n){var e=this;this.showComment=!this.showComment,this.commCount=n,(0,a.getComment)(t).then(function(t){console.log(o(t," at pages\\daily\\daily.vue:285")),t?(t.filter(function(t){t.moreComment=!1,t.showComment=!1,(0,a.getReply)(t.id).then(function(n){n&&(t.moreComment=n)})}),setTimeout(function(){e.commentInfo=t,console.log(o(t," at pages\\daily\\daily.vue:300"))},200)):e.commentInfo=[]})},hidComm:function(){this.showComment=!this.showComment,this.commentInfo="",t.showTabBar()},addComm:function(t){var n=this;"reply"==this.addType?(0,a.reply)(this.cid,t,0,this.toid).then(function(t){n.addType="comm",(0,a.getComment)(n.did).then(function(t){t.filter(function(t){t.moreComment=!1,t.showComment=!0,(0,a.getReply)(t.id).then(function(n){n&&(t.moreComment=n)})}),setTimeout(function(){n.commentInfo=t},200)})}):"comm"==this.addType?(0,a.createCom)(this.did,t).then(function(t){console.log(o(t," at pages\\daily\\daily.vue:332")),(0,a.getComment)(n.did).then(function(t){n.commCount+=1,n.addType="comm",n.dynInfo[n.index].com_count+=1,t.filter(function(t){t.moreComment=!1,t.showComment=!0,(0,a.getReply)(t.id).then(function(n){n&&(t.moreComment=n)})}),setTimeout(function(){n.commentInfo=t},200)}),n.getAllBullet()}):"nextReply"==this.addType&&(0,a.reply)(this.cid,t,this.parentId,this.toid).then(function(t){n.addType="comm",(0,a.getComment)(n.did).then(function(t){t.filter(function(t){t.moreComment=!1,t.showComment=!0,(0,a.getReply)(t.id).then(function(n){n&&(t.moreComment=n)})}),setTimeout(function(){n.commentInfo=t},200)})})},replyComm:function(t){this.addType="reply",this.cid=this.commentInfo[t].id,this.toid=this.commentInfo[t].uid},nextReplyComm:function(t,n,e){this.addType="nextReply",this.cid=t,this.parentId=n,this.toid=e},deleteComm:function(n,e,o){var i=t.getStorageSync("USERS_KEY").id,c=this;e==i&&t.showModal({title:"",content:"確定刪除評論",confirmText:"確定",success:function(t){t.confirm&&(0,a.deleteComm)(n).then(function(t){c.commentInfo.splice(o,1)})}})},deleteReply:function(n,e,o,i){var c=t.getStorageSync("USERS_KEY").id,s=this;e==c&&t.showModal({title:"",content:"確定刪除評論",confirmText:"確定",success:function(t){t.confirm&&(0,a.deleteReply)(n).then(function(t){s.commentInfo[o].moreComment.splice(o,1)})}})},getAllBullet:function(){var t=this;this.showBullet&&(0,a.getBullet)(this.did).then(function(n){n.content;t.$refs.lBarrage.start(n.content)})},showDoomm:function(){this.showBullet=!this.showBullet,this.showBullet&&this.getAllBullet()},tapShare:function(){t.showToast({icon:"none",title:"分享索引为".concat(this.index,"的视频")})},publishDyn:function(){var n=this;t.chooseImage({sourceType:["camera","album"],sizeType:["original"],count:1,success:function(){var e=u(i.default.mark(function e(o){var c,a,s,r,u;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:c=o.tempFilePaths,a=[],s=0;case 3:if(!(s<c.length)){e.next=12;break}return r=c[s],e.next=7,n.compressImageHandler(r);case 7:u=e.sent,a.push(u);case 9:s++,e.next=3;break;case 12:n.$store.commit("setImgTemp",a[0]),t.navigateTo({url:"crop"});case 14:case"end":return e.stop()}},e,this)}));function o(t){return e.apply(this,arguments)}return o}()})},compressImageHandler:function(){var t=u(i.default.mark(function t(n){var e;return i.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return console.log(o("platform==="+h.platform," at pages\\daily\\daily.vue:465")),t.next=3,(0,c.default)(n,h.platform);case 3:return e=t.sent,console.log(o("tempPath-----"+e," at pages\\daily\\daily.vue:467")),t.abrupt("return",e);case 6:case"end":return t.stop()}},t,this)}));function n(n){return t.apply(this,arguments)}return n}(),behaviour:function(){var n=this;t.showActionSheet({itemList:["取消關注","屏蔽用戶","舉報用戶"],success:function(e){if(0==e.tapIndex){if(0==n.dynInfo[n.index].following)return void t.showToast({icon:"none",title:"暫未關注該用戶"});t.showModal({title:"",content:"確定取消關注",confirmText:"確定",success:function(t){t.confirm?(0,a.concern)(2,n.uid).then(function(t){n.dynInfo[n.index].following=0}):t.cancel}})}if(1==e.tapIndex&&t.showModal({title:"",content:"屏蔽用戶",confirmText:"確定",success:function(t){t.confirm||t.cancel}}),2==e.tapIndex){var o={did:n.did,id:n.uid,name:n.dynInfo[n.index].name,avatar:n.dynInfo[n.index].portrait};t.showModal({title:"",content:"舉報用戶",confirmText:"確定",success:function(n){n.confirm?t.navigateTo({url:"/pages/msg/report?userInfo="+JSON.stringify(o)}):n.cancel}})}},fail:function(t){console.log(o(t.errMsg," at pages\\daily\\daily.vue:538"))}})}}};n.default=v}).call(this,e("6e42")["default"],e("0de9")["default"])},dd6c:function(t,n,e){"use strict";e.r(n);var o=e("2bd5"),i=e("dbcd");for(var c in i)"default"!==c&&function(t){e.d(n,t,function(){return i[t]})}(c);e("30a8");var a=e("2877"),s=Object(a["a"])(i["default"],o["a"],o["b"],!1,null,"6875a3fb",null);n["default"]=s.exports},fe39:function(t,n,e){"use strict";(function(t){e("cbab"),e("921b");o(e("66fd"));var n=o(e("dd6c"));function o(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("6e42")["createPage"])}},[["fe39","common/runtime","common/vendor"]]]);