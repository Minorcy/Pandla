(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/nearby/nearby"],{1655:function(e,t,n){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;n("996b");var i=n("0be9"),r=function(){return n.e("components/uni-tag/uni-tag").then(n.bind(null,"a9ca"))},o=function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"6804"))},u={components:{uniPopup:o,uniTag:r},data:function(){return{searchValue:"",tga:"",scope:10,longitude:"",latitude:"",nearbyInfo:[],remind:"",distance:[{inverted:!1,value:10},{inverted:!0,value:50},{inverted:!0,value:100}],arrangement:!1,character:[{inverted:!0,value:0},{inverted:!0,value:.5},{inverted:!0,value:1},{inverted:!0,value:"0.5偏0"},{inverted:!0,value:"0.5偏1"},{inverted:!0,value:"S"},{inverted:!0,value:"M"},{inverted:!0,value:"其它"}],ageRange:{max:70,min:18},weightRange:{max:200,min:40},heightRange:{max:220,min:150}}},methods:{toUserInfo:function(t,n){e.navigateTo({url:"/pages/daily/userInfo?uid="+t+"&distance="+n})},updateLab:function(t){var n=e.getStorageSync("USERS_KEY").id;n==t&&e.redirectTo({url:"tga"})},search:function(){var t=this,n=e.getStorageSync("nearbyInfo"),a=new RegExp("("+t.searchValue+")","img"),i=[];n.forEach(function(e){a.test(e.name)&&i.push(e),a.test(e.lable)&&i.push(e)}),0!=i.length?(t.nearbyInfo=[],t.nearbyInfo=t.repeat(i)):e.showToast({icon:"none",title:"暫無搜索結果"})},repeat:function(e){for(var t=[],n=0;n<e.length;n++){for(var a=!0,i=0;i<t.length;i++)e[n].uid==t[i].uid&&(a=!1);a&&t.push(e[n])}return t},reasonable:function(t){1==t&&(this.ageRange.min=Number(this.ageRange.min),this.ageRange.max=Number(this.ageRange.max),(this.ageRange.min<18||this.ageRange.max>70||this.ageRange.min>this.ageRange.max)&&e.showToast({icon:"none",title:"请输入合理的年龄范围（18~70）"})),2==t&&(this.weightRange.min=Number(this.weightRange.min),this.weightRange.max=Number(this.weightRange.max),(this.weightRange.min<40||this.weightRange.max>200||this.weightRange.min>this.weightRange.max)&&e.showToast({icon:"none",title:"请输入合理的体重范围（40~200kg）"})),3==t&&(this.heightRange.min=Number(this.heightRange.min),this.heightRange.max=Number(this.heightRange.max),(this.heightRange.min<150||this.heightRange.max>220||this.heightRange.min>this.heightRange.max)&&e.showToast({icon:"none",title:"请输入合理的年龄范围（150~220cm）"}))},sliderChange1:function(e){this.ageRange.max=e.detail.value,console.log(a(this.ageRange," at pages\\nearby\\nearby.vue:308"))},sliderChange2:function(e){this.weightRange.max=e.detail.value},sliderChange3:function(e){this.heightRange.max=e.detail.value},reset:function(){this.distance=[{inverted:!1,value:10},{inverted:!0,value:50},{inverted:!0,value:100}],this.arrangement=!1,this.character=[{inverted:!0,value:0},{inverted:!0,value:.5},{inverted:!0,value:1},{inverted:!0,value:"0.5偏0"},{inverted:!0,value:"0.5偏1"},{inverted:!0,value:"S"},{inverted:!0,value:"M"},{inverted:!0,value:"其它"}],this.ageRange={max:70,min:18},this.weightRange={max:200,min:40},this.heightRange={max:220,min:150}},openPopup:function(){this.$refs.popup.open()},closePopup:function(){var t=this;this.nearbyInfo=[];var n=[];e.showLoading({title:"加载中"}),this.$refs.popup.close();for(var r=0;r<this.character.length;r++)this.character[r].inverted||n.push({type:"acctType",value:this.character[r].value});var o={rangesFilter:function(e,t){if(0===t.length)return e;var n=!0,a=!1,i=void 0;try{for(var r,o=function(){var t=r.value;e=e.filter(function(e){return e[t.type]>=t.min&&e[t.type]<=t.max})},u=t[Symbol.iterator]();!(n=(r=u.next()).done);n=!0)o()}catch(s){a=!0,i=s}finally{try{n||null==u.return||u.return()}finally{if(a)throw i}}return e},choosesFilter:function(e,t){var n=[];if(0===t.length)n=e;else{var a=!0,i=!1,r=void 0;try{for(var o,u=function(){var t=o.value;n=n.concat(e.filter(function(e){return-1!==e[t.type].indexOf(t.value)}))},s=t[Symbol.iterator]();!(a=(o=s.next()).done);a=!0)u()}catch(g){i=!0,r=g}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}}return n}},u={ranges:[{type:"age",max:this.ageRange.max,min:this.ageRange.min},{type:"stature",max:this.heightRange.max,min:this.heightRange.min},{type:"weight",max:this.weightRange.max,min:this.weightRange.min}],chooses:n};function s(e,t){for(var n in t)o.hasOwnProperty(n+"Filter")&&"function"===typeof o[n+"Filter"]&&(e=o[n+"Filter"](e,u[n]));return e}console.log(a(u," at pages\\nearby\\nearby.vue:449")),(0,i.checkNearbyPerson)(this.longitude,this.latitude,this.scope,this.tga).then(function(n){0==n.length&&(t.remind="附近暫無居民,請點擊右上角擴大範圍"),n.filter(function(e){(0,i.getInfo)(e.uid).then(function(t){var n=t.age+"/"+t.stature+"/"+t.weight+"/"+t.acctType;e.info=n,e.age=t.age,e.stature=t.stature,e.weight=t.weight,e.acctType=t.acctType})}),setTimeout(function(){var i=s(n,u);console.log(a(i," at pages\\nearby\\nearby.vue:477")),t.nearbyInfo=i,0==t.nearbyInfo.length&&(t.remind="暫無篩選結果"),e.setStorageSync("nearbyInfo",n),e.hideLoading()},200)})},setDistance:function(e){for(var t=0;t<this.distance.length;t++)this.distance[t].inverted=!0;this.distance[e].inverted=!this.distance[e].inverted,this.scope=this.distance[e].value},setArrangement:function(){this.arrangement=!this.arrangement},setCharacter:function(e){this.character[e].inverted=!this.character[e].inverted}},onNavigationBarButtonTap:function(){this.$refs.popup.open()},onLoad:function(t){t.tga&&(this.tga=t.tga),""!=this.tga&&e.setStorageSync("tga",this.tga),e.showLoading({title:"加载中"});var n=this;e.getLocation({type:"wgs84",success:function(t){n.longitude=t.longitude,n.latitude=t.latitude,(0,i.checkNearbyPerson)(n.longitude,n.latitude,n.scope,n.tga).then(function(t){0==t.length&&(n.remind="附近暫無居民,請點擊右上角擴大範圍"),t.filter(function(e){(0,i.getInfo)(e.uid).then(function(t){var n=t.age+"/"+t.stature+"/"+t.weight+"/"+t.acctType;e.info=n,e.age=t.age,e.stature=t.stature,e.weight=t.weight,e.acctType=t.acctType})}),setTimeout(function(){n.nearbyInfo=t,e.setStorageSync("nearbyInfo",t),console.log(a(t," at pages\\nearby\\nearby.vue:544")),e.hideLoading()},500)})},fail:function(){e.hideLoading(),n.remind="获取定位权限失败"}})},onPullDownRefresh:function(){this.nearbyInfo="";var t=this;e.getLocation({type:"wgs84",success:function(n){t.longitude=n.longitude,t.latitude=n.latitude,(0,i.checkNearbyPerson)(t.longitude,t.latitude,t.scope,t.tga).then(function(n){n.filter(function(e){(0,i.getInfo)(e.uid).then(function(t){var n=t.age+"/"+t.stature+"/"+t.weight+"/"+t.acctType;e.info=n,e.age=t.age,e.stature=t.stature,e.weight=t.weight,e.acctType=t.acctType})}),setTimeout(function(){t.nearbyInfo=n,e.setStorageSync("nearbyInfo",n)},500)})}}),setTimeout(function(){e.stopPullDownRefresh()},800)}};t.default=u}).call(this,n("6e42")["default"],n("0de9")["default"])},"4fd8":function(e,t,n){"use strict";n.r(t);var a=n("ee11"),i=n("6906");for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);n("7b72");var o=n("2877"),u=Object(o["a"])(i["default"],a["a"],a["b"],!1,null,"74aeb05b",null);t["default"]=u.exports},6906:function(e,t,n){"use strict";n.r(t);var a=n("1655"),i=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,function(){return a[e]})}(r);t["default"]=i.a},"6c33":function(e,t,n){"use strict";(function(e){n("274e"),n("921b");a(n("66fd"));var t=a(n("4fd8"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},"7b72":function(e,t,n){"use strict";var a=n("bebd"),i=n.n(a);i.a},bebd:function(e,t,n){},ee11:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.nearbyInfo,function(t,n){var a=e._f("toFixed")(t.scope,2);return{$orig:e.__get_orig(t),f0:a}}));e.$mp.data=Object.assign({},{$root:{l0:n}})},i=[];n.d(t,"a",function(){return a}),n.d(t,"b",function(){return i})}},[["6c33","common/runtime","common/vendor"]]]);